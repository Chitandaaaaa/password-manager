# 密码管家 - 单元测试用例设计文档

## 1. 项目功能模块分析

### 1.1 后端服务层 (electron/services/)

| 模块 | 文件路径 | 职责描述 |
|------|----------|----------|
| **CryptoService** | `electron/services/crypto.ts` | 加密/解密、密码哈希、随机密码生成、密码强度计算 |
| **PasswordService** | `electron/services/password.ts` | 密码的增删改查、加密存储、解密读取 |
| **DatabaseService** | `electron/services/database.ts` | 数据持久化、配置管理、分类管理 |
| **OllamaService** | `electron/services/ollama.ts` | AI智能导入、密码解析、Ollama连接管理 |

### 1.2 前端组件层 (src/components/)

| 组件 | 文件路径 | 职责描述 |
|------|----------|----------|
| **PasswordCard** | `src/components/PasswordCard.tsx` | 密码卡片展示、显示/隐藏密码、复制、编辑、删除 |
| **AddPasswordModal** | `src/components/AddPasswordModal.tsx` | 添加密码表单、密码强度显示、随机密码生成 |
| **EditPasswordModal** | `src/components/EditPasswordModal.tsx` | 编辑密码表单 |
| **CategoryModal** | `src/components/CategoryModal.tsx` | 分类管理（增删改） |
| **CategoryDisplayModal** | `src/components/CategoryDisplayModal.tsx` | 显示分类配置 |
| **SettingsModal** | `src/components/SettingsModal.tsx` | 应用设置（Ollama/安全/危险操作） |
| **ChangePasswordModal** | `src/components/ChangePasswordModal.tsx` | 修改主密码 |
| **ExportModal** | `src/components/ExportModal.tsx` | 密码导出功能 |
| **SmartImportModal** | `src/components/SmartImportModal.tsx` | AI智能导入 |

### 1.3 页面层 (src/pages/)

| 页面 | 文件路径 | 职责描述 |
|------|----------|----------|
| **LoginPage** | `src/pages/LoginPage.tsx` | 登录、忘记密码重置 |
| **SetupPage** | `src/pages/SetupPage.tsx` | 首次使用设置主密码 |
| **MainPage** | `src/pages/MainPage.tsx` | 主界面、密码列表、搜索筛选 |

### 1.4 状态管理与工具 (src/)

| 模块 | 文件路径 | 职责描述 |
|------|----------|----------|
| **appStore** | `src/stores/appStore.ts` | Zustand全局状态管理 |
| **utils** | `src/lib/utils.ts` | 工具函数（cn、密码强度、日期格式化） |
| **types** | `src/types/index.ts` | TypeScript类型定义 |

---

## 2. 单元测试用例设计

### 2.1 CryptoService 测试用例

**文件**: `electron/services/crypto.test.ts`

#### 2.1.1 盐值生成 (generateSalt)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CS-001 | 生成盐值-基本功能 | 调用 generateSalt() | 返回64字符的十六进制字符串 | 高 |
| CS-002 | 生成盐值-唯一性 | 连续调用两次 generateSalt() | 两次返回结果不同 | 高 |
| CS-003 | 生成盐值-格式验证 | 调用 generateSalt() 并验证格式 | 结果只包含0-9a-f字符 | 中 |

#### 2.1.2 主密码哈希 (hashMasterPassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CS-004 | 哈希密码-基本功能 | 输入密码"test123"和盐值 | 返回64字符的十六进制哈希值 | 高 |
| CS-005 | 哈希密码-确定性 | 使用相同密码和盐值调用两次 | 两次返回相同的哈希值 | 高 |
| CS-006 | 哈希密码-不同盐值 | 使用相同密码但不同盐值 | 返回不同的哈希值 | 高 |
| CS-007 | 哈希密码-空字符串 | 输入空密码和有效盐值 | 返回有效的哈希值（不报错） | 中 |
| CS-008 | 哈希密码-长密码 | 输入100位长度的密码 | 成功返回哈希值 | 中 |
| CS-009 | 哈希密码-Unicode字符 | 输入包含中文和emoji的密码 | 成功返回哈希值 | 中 |

#### 2.1.3 密钥派生 (deriveKey)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CS-010 | 派生密钥-基本功能 | 输入密码和盐值 | 返回32字节(256位)的Buffer | 高 |
| CS-011 | 派生密钥-确定性 | 使用相同输入调用两次 | 返回相同的密钥 | 高 |
| CS-012 | 派生密钥-敏感性 | 使用略微不同的输入 | 返回完全不同的密钥 | 高 |

#### 2.1.4 加密解密 (encryptPassword/decryptPassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CS-013 | 加密-基本功能 | 加密明文"myPassword123" | 返回包含encrypted、iv、authTag的对象 | 高 |
| CS-014 | 解密-基本功能 | 解密之前加密的数据 | 返回原始明文"myPassword123" | 高 |
| CS-015 | 加密-不同结果 | 两次加密相同明文 | 返回不同的encrypted值(IV不同) | 高 |
| CS-016 | 解密-错误密钥 | 使用错误密钥解密 | 抛出解密失败错误 | 高 |
| CS-017 | 解密-篡改数据 | 篡改密文后解密 | 抛出认证失败错误 | 高 |
| CS-018 | 加密-空字符串 | 加密空字符串 | 成功加密并可以解密还原 | 中 |
| CS-019 | 加密-长密码 | 加密1000位长度的密码 | 成功加密并可以解密还原 | 中 |
| CS-020 | 加密-特殊字符 | 加密包含各种特殊字符的密码 | 成功加密并可以解密还原 | 中 |
| CS-021 | 加密-中文密码 | 加密中文字符密码 | 成功加密并可以解密还原 | 中 |
| CS-022 | 解密-篡改IV | 使用错误IV解密 | 抛出错误 | 中 |
| CS-023 | 解密-篡改AuthTag | 使用错误AuthTag解密 | 抛出认证失败错误 | 中 |

#### 2.1.5 随机密码生成 (generateRandomPassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CS-024 | 生成密码-默认参数 | 调用 generateRandomPassword() | 返回16位长度的密码 | 高 |
| CS-025 | 生成密码-指定长度 | 生成长度为32的密码 | 返回32位长度的密码 | 高 |
| CS-026 | 生成密码-仅小写 | includeLowercase=true, 其他=false | 密码只包含a-z | 高 |
| CS-027 | 生成密码-仅大写 | includeUppercase=true, 其他=false | 密码只包含A-Z | 高 |
| CS-028 | 生成密码-仅数字 | includeNumbers=true, 其他=false | 密码只包含0-9 | 高 |
| CS-029 | 生成密码-仅符号 | includeSymbols=true, 其他=false | 密码只包含!@#$%^&*等符号 | 高 |
| CS-030 | 生成密码-全部禁用 | 所有选项设为false | 使用默认字符集(a-z,0-9) | 中 |
| CS-031 | 生成密码-唯一性 | 连续生成10个密码 | 所有密码都不相同 | 中 |
| CS-032 | 生成密码-长度为1 | 生成长度为1的密码 | 返回1个字符的密码 | 低 |
| CS-033 | 生成密码-长度为0 | 生成长度为0的密码 | 返回空字符串 | 低 |
| CS-034 | 生成密码-超长长度 | 生成长度为1000的密码 | 返回1000个字符的密码 | 低 |

#### 2.1.6 密码强度计算 (calculatePasswordStrength)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CS-035 | 强度-空密码 | 输入"" | 返回0 | 高 |
| CS-036 | 强度-非常弱 | 输入"abc" | 返回<30的值 | 高 |
| CS-037 | 强度-弱 | 输入"abcdefgh" | 返回30-49的值 | 高 |
| CS-038 | 强度-一般 | 输入"Abcdefgh1" | 返回50-69的值 | 高 |
| CS-039 | 强度-强 | 输入"Abcdefgh123" | 返回70-89的值 | 高 |
| CS-040 | 强度-非常强 | 输入"Abcdefgh123!@#" | 返回≥90的值 | 高 |
| CS-041 | 强度-满分 | 输入16位包含所有类型的密码 | 返回100 | 中 |
| CS-042 | 强度-超长密码 | 输入50位小写字母 | 检查分数上限 | 中 |

---

### 2.2 PasswordService 测试用例

**文件**: `electron/services/password.test.ts`

#### 2.2.1 添加密码 (addPassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PS-001 | 添加密码-基本功能 | 添加包含所有字段的密码数据 | 返回新密码ID，数据库中存储加密后的密码 | 高 |
| PS-002 | 添加密码-仅必填字段 | 只提供softwareName和password | 成功添加，其他字段为undefined或默认值 | 高 |
| PS-003 | 添加密码-空分类 | 添加时category为undefined | 数据库中存储为"未分类" | 高 |
| PS-004 | 添加密码-加密验证 | 添加密码后查询数据库 | 密码字段是加密后的JSON字符串，不是明文 | 高 |
| PS-005 | 添加密码-特殊字符 | 添加包含特殊字符的密码 | 正确加密存储，可以正常解密 | 中 |
| PS-006 | 添加密码-Unicode | 添加包含中文的密码 | 正确加密存储，可以正常解密 | 中 |
| PS-007 | 添加密码-超长内容 | 添加包含超长notes的密码 | 成功存储 | 中 |

#### 2.2.2 获取密码列表 (getPasswords)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PS-008 | 获取列表-无筛选 | 调用 getPasswords() | 返回所有密码列表，不包含encrypted_password字段 | 高 |
| PS-009 | 获取列表-搜索筛选 | 使用search参数搜索 | 返回匹配的密码，按名称/用户名/URL搜索 | 高 |
| PS-010 | 获取列表-分类筛选 | 使用category参数筛选 | 返回指定分类的密码 | 高 |
| PS-011 | 获取列表-组合筛选 | 同时使用search和category | 返回同时满足两个条件的密码 | 高 |
| PS-012 | 获取列表-排序验证 | 获取列表 | 结果按updated_at降序排列 | 高 |
| PS-013 | 获取列表-无结果 | 使用不存在的搜索词 | 返回空数组 | 中 |
| PS-014 | 获取列表-大小写不敏感 | 使用不同大小写搜索 | 返回相同结果 | 中 |
| PS-015 | 获取列表-空数据库 | 数据库为空时调用 | 返回空数组 | 中 |

#### 2.2.3 解密密码 (decryptPassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PS-016 | 解密-基本功能 | 解密存在的密码ID | 返回正确的明文密码 | 高 |
| PS-017 | 解密-不存在ID | 解密不存在的密码ID | 抛出"密码记录不存在"错误 | 高 |
| PS-018 | 解密-错误密钥 | 使用错误密钥的服务实例解密 | 抛出解密错误 | 高 |
| PS-019 | 解密-特殊字符 | 解密包含特殊字符的密码 | 返回原始明文 | 中 |
| PS-020 | 解密-Unicode | 解密包含中文的密码 | 返回原始明文 | 中 |

#### 2.2.4 更新密码 (updatePassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PS-021 | 更新-部分字段 | 只更新username字段 | 只修改username，其他字段保持不变 | 高 |
| PS-022 | 更新-密码字段 | 更新password字段 | 新密码被加密存储，可以正常解密 | 高 |
| PS-023 | 更新-所有字段 | 更新所有可更新字段 | 所有字段都被正确更新 | 高 |
| PS-024 | 更新-不存在ID | 更新不存在的密码ID | 抛出"密码记录不存在"错误 | 高 |
| PS-025 | 更新-空分类 | 更新时category为空字符串 | 不修改原分类 | 中 |
| PS-026 | 更新-更新时间 | 更新密码后 | updated_at字段被更新 | 中 |
| PS-027 | 更新-notes字段 | 更新notes字段 | notes正确保存（历史bug点） | 高 |

#### 2.2.5 删除密码 (deletePassword)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PS-028 | 删除-基本功能 | 删除存在的密码 | 密码从数据库中移除 | 高 |
| PS-029 | 删除-不存在ID | 删除不存在的密码ID | 不报错，数据库无变化 | 中 |
| PS-030 | 删除-后验证 | 删除后获取列表 | 被删除的密码不在列表中 | 高 |

#### 2.2.6 导出密码 (exportAllPasswords)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PS-031 | 导出-基本功能 | 调用 exportAllPasswords() | 返回包含明文密码的数组 | 高 |
| PS-032 | 导出-字段验证 | 检查导出数据 | 包含id、softwareName、username、password(明文)、url、notes、category、createdAt、updatedAt | 高 |
| PS-033 | 导出-排序验证 | 导出数据 | 按updated_at降序排列 | 中 |
| PS-034 | 导出-空数据库 | 数据库为空时导出 | 返回空数组 | 中 |
| PS-035 | 导出-部分解密失败 | 模拟解密失败的情况 | 失败的记录被跳过，其他正常返回 | 中 |

---

### 2.3 DatabaseService 测试用例

**文件**: `electron/services/database.test.ts`

#### 2.3.1 初始化 (init)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| DB-001 | 初始化-默认值 | 新数据库初始化 | 默认分类正确设置 | 高 |
| DB-002 | 初始化-配置迁移 | 缺少新配置字段的旧数据库 | 自动添加缺失的配置字段 | 高 |
| DB-003 | 初始化-ID恢复 | 重启后初始化 | ID计数器正确恢复 | 中 |

#### 2.3.2 用户管理

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| DB-004 | 检查用户-无用户 | 空数据库调用 hasUser() | 返回false | 高 |
| DB-005 | 检查用户-有用户 | 创建用户后调用 hasUser() | 返回true | 高 |
| DB-006 | 创建用户-基本功能 | 调用 createUser() | 返回用户ID，用户被存储 | 高 |
| DB-007 | 获取用户-无用户 | 空数据库调用 getUser() | 返回null | 高 |
| DB-008 | 获取用户-有用户 | 创建用户后调用 getUser() | 返回用户对象 | 高 |
| DB-009 | 更新用户密码 | 调用 updateUserPassword() | 密码哈希和盐值被更新 | 高 |
| DB-010 | 重置主密码 | 调用 resetMasterPassword() | 清空所有密码和用户，创建新用户 | 高 |

#### 2.3.3 密码CRUD

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| DB-011 | 添加密码 | 调用 addPassword() | 返回ID，数据被存储 | 高 |
| DB-012 | 获取密码列表 | 添加多个密码后调用 getPasswords() | 返回密码列表（不含加密字段） | 高 |
| DB-013 | 根据ID获取 | 调用 getPasswordById() | 返回完整密码记录（含加密字段） | 高 |
| DB-014 | 更新密码 | 调用 updatePassword() | 指定字段被更新 | 高 |
| DB-015 | 删除密码 | 调用 deletePassword() | 密码被删除 | 高 |
| DB-016 | 清除所有密码 | 调用 clearAllPasswords() | 所有密码被删除，ID计数器重置 | 高 |
| DB-017 | 获取所有密码 | 调用 getAllPasswords() | 返回所有密码（含加密字段） | 高 |

#### 2.3.4 分类管理

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| DB-018 | 获取分类 | 调用 getCategories() | 返回分类数组 | 高 |
| DB-019 | 添加分类 | 调用 addCategory() | 新分类被添加 | 高 |
| DB-020 | 添加重复分类 | 添加已存在的分类 | 不重复添加 | 中 |
| DB-021 | 删除分类 | 调用 deleteCategory() | 分类被删除，该分类下密码移到"未分类" | 高 |
| DB-022 | 重命名分类 | 调用 renameCategory() | 分类名更新，该分类下密码的分类字段更新 | 高 |
| DB-023 | 重命名为已存在 | 重命名为已存在的分类名 | 抛出错误或忽略（需确认行为） | 中 |

#### 2.3.5 配置管理

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| DB-024 | 获取配置 | 调用 getConfig() | 返回完整配置对象 | 高 |
| DB-025 | 更新配置 | 调用 updateConfig() | 配置被更新 | 高 |
| DB-026 | 获取显示分类 | 调用 getDisplayCategories() | 返回配置中启用的显示分类 | 高 |
| DB-027 | 更新显示分类 | 调用 updateDisplayCategories() | 显示分类配置被更新 | 高 |
| DB-028 | 显示分类-未启用 | 关闭显示分类功能 | 返回所有分类 | 中 |
| DB-029 | 显示分类-过滤无效 | 配置中包含已删除的分类 | 自动过滤掉无效分类 | 中 |

---

### 2.4 OllamaService 测试用例

**文件**: `electron/services/ollama.test.ts`

#### 2.4.1 配置管理

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| OL-001 | 获取配置 | 调用 getConfig() | 返回Ollama配置对象 | 高 |
| OL-002 | 更新配置 | 调用 updateConfig() | 配置被更新 | 高 |
| OL-003 | 部分更新配置 | 只更新host字段 | 只修改host，其他保持不变 | 高 |

#### 2.4.2 连接检查 (checkAvailability)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| OL-004 | 检查-未启用 | 配置enabled=false时调用 | 返回available=false, message="Ollama功能未启用" | 高 |
| OL-005 | 检查-连接成功 | 模拟Ollama服务正常 | 返回available=true | 高 |
| OL-006 | 检查-模型不存在 | 服务正常但模型不存在 | 返回available=false, message包含可用模型列表 | 高 |
| OL-007 | 检查-连接失败 | 模拟服务未启动 | 返回available=false, message包含连接错误 | 高 |
| OL-008 | 检查-超时 | 模拟连接超时 | 返回available=false, message="连接超时" | 高 |
| OL-009 | 检查-HTTP错误 | 模拟返回非200状态码 | 返回available=false, message包含HTTP状态码 | 中 |

#### 2.4.3 密码解析 (parsePasswords)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| OL-010 | 解析-未启用 | 配置enabled=false时调用 | 返回success=false, error="Ollama功能未启用" | 高 |
| OL-011 | 解析-成功 | 模拟AI返回正确JSON | 返回success=true, entries包含解析结果 | 高 |
| OL-012 | 解析-空结果 | 输入无密码信息的文本 | 返回空数组或错误 | 高 |
| OL-013 | 解析-JSON代码块 | AI返回markdown代码块格式 | 正确提取JSON并解析 | 高 |
| OL-014 | 解析-中文字段名 | AI返回中文字段名 | 正确映射到英文字段名 | 高 |
| OL-015 | 解析-无效JSON | AI返回无效JSON | 返回错误，包含rawResponse | 高 |
| OL-016 | 解析-网络错误 | 模拟网络请求失败 | 返回success=false, error包含错误信息 | 高 |
| OL-017 | 解析-备用方案 | AI解析失败但有可识别格式 | 使用parseSimpleText提取密码 | 中 |
| OL-018 | 解析-乱码检测 | AI返回包含乱码的响应 | 检测并处理乱码 | 中 |

#### 2.4.4 URL推断 (inferUrl)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| OL-019 | 推断-已知软件 | 输入"微信" | 返回"https://weixin.qq.com" | 中 |
| OL-020 | 推断-未知软件 | 输入"未知软件" | 返回undefined | 中 |
| OL-021 | 推断-大小写不敏感 | 输入"GITHUB" | 返回"https://github.com" | 低 |

#### 2.4.5 分类推断 (inferCategory)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| OL-022 | 推断-社交类 | 输入"微信" | 返回"社交" | 中 |
| OL-023 | 推断-购物类 | 输入"淘宝" | 返回"购物" | 中 |
| OL-024 | 推断-银行类 | 输入"支付宝" | 返回"银行" | 中 |
| OL-025 | 推断-未知 | 输入"未知软件" | 返回"未分类" | 中 |

---

### 2.5 工具函数测试用例 (已存在，补充)

**文件**: `src/lib/utils.test.ts` (已有测试)

#### 补充测试用例

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| UT-001 | cn-空参数 | 调用 cn() | 返回空字符串 | 低 |
| UT-002 | cn-数组参数 | 调用 cn(['class1', 'class2']) | 正确处理数组 | 低 |
| UT-003 | cn-对象参数 | 调用 cn({ 'class1': true, 'class2': false }) | 正确处理对象 | 低 |
| UT-004 | formatDate-无效日期 | 传入无效日期字符串 | 返回"Invalid Date"或优雅处理 | 低 |
| UT-005 | formatDate-不同时区 | 传入不同时区的日期 | 正确格式化为本地时间 | 低 |

---

### 2.6 状态管理测试用例 (已存在，补充)

**文件**: `src/stores/appStore.test.ts` (已有测试)

#### 补充测试用例

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| ST-001 | 状态-重置 | 修改多个状态后重置 | 所有状态回到初始值 | 中 |
| ST-002 | addPassword-重复ID | 添加相同ID的密码 | 处理重复（根据实现） | 中 |
| ST-003 | removePassword-不存在ID | 移除不存在的ID | 状态无变化 | 低 |

---

### 2.7 UI组件测试用例

#### 2.7.1 PasswordCard 测试用例

**文件**: `src/components/PasswordCard.test.tsx`

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| PC-001 | 渲染-基本 | 传入有效password对象 | 正确渲染软件名、用户名、分类 | 高 |
| PC-002 | 渲染-可选字段 | 传入缺少可选字段的password | 不显示username/url/notes区域 | 高 |
| PC-003 | 渲染-自定义分类 | 传入自定义分类名称 | 显示自定义分类名 | 高 |
| PC-004 | 渲染-空分类 | 传入空字符串分类 | 显示"未分类" | 高 |
| PC-005 | 显示密码-点击 | 点击眼睛图标 | 调用decryptPassword，显示明文 | 高 |
| PC-006 | 显示密码-再次点击 | 再次点击眼睛图标 | 隐藏密码，显示"••••••••" | 高 |
| PC-007 | 复制密码-未显示 | 点击复制按钮（密码未显示） | 先解密，再复制 | 高 |
| PC-008 | 复制密码-已显示 | 点击复制按钮（密码已显示） | 直接复制已解密的密码 | 高 |
| PC-009 | 复制成功-视觉反馈 | 复制成功后 | 显示对勾图标，2秒后恢复 | 中 |
| PC-010 | 编辑密码 | 点击编辑按钮 | 调用onEdit，传入password和解密后的密码 | 高 |
| PC-011 | 删除密码-确认 | 点击删除并确认 | 调用deletePassword，成功后调用onDelete | 高 |
| PC-012 | 删除密码-取消 | 点击删除但取消 | 不调用deletePassword | 高 |
| PC-013 | 分类徽章-样式 | 不同分类 | 显示对应的颜色样式 | 中 |
| PC-014 | 日期格式化 | 检查更新时间显示 | 正确格式化显示 | 低 |
| PC-015 | URL链接 | 点击URL | 在新窗口打开链接 | 中 |

#### 2.7.2 AddPasswordModal 测试用例

**文件**: `src/components/AddPasswordModal.test.tsx`

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| AP-001 | 渲染-关闭 | isOpen=false | 不渲染任何内容 | 高 |
| AP-002 | 渲染-打开 | isOpen=true | 渲染完整的表单 | 高 |
| AP-003 | 加载分类 | 组件打开时 | 调用listCategories加载分类 | 高 |
| AP-004 | 表单验证-空软件名 | 提交空软件名 | 显示错误"请输入软件名称" | 高 |
| AP-005 | 表单验证-空密码 | 提交空密码 | 显示错误"请输入密码" | 高 |
| AP-006 | 密码强度-显示 | 输入密码时 | 显示密码强度条和文字 | 高 |
| AP-007 | 密码强度-计算 | 输入不同强度的密码 | 强度指示正确变化 | 中 |
| AP-008 | 生成密码 | 点击刷新按钮 | 调用generatePassword，填充密码字段 | 高 |
| AP-009 | 显示/隐藏密码 | 点击眼睛图标 | 切换密码输入框的type | 高 |
| AP-010 | 提交成功 | 填写有效数据并提交 | 调用addPassword，成功后调用onSuccess和onClose | 高 |
| AP-011 | 提交失败 | 模拟addPassword返回错误 | 显示错误信息 | 高 |
| AP-012 | 关闭按钮 | 点击关闭按钮 | 调用onClose | 高 |
| AP-013 | 取消按钮 | 点击取消按钮 | 调用onClose | 高 |
| AP-014 | 表单重置 | 成功提交后 | 表单字段重置为空 | 中 |
| AP-015 | 分类选择 | 选择不同分类 | category字段更新 | 中 |

#### 2.7.3 CategoryModal 测试用例

**文件**: `src/components/CategoryModal.test.tsx`

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| CM-001 | 渲染-分类列表 | 打开modal | 显示所有分类 | 高 |
| CM-002 | 添加分类-空值 | 添加空分类名 | 显示错误"请输入分类名称" | 高 |
| CM-003 | 添加分类-重复 | 添加已存在的分类名 | 显示错误"分类已存在" | 高 |
| CM-004 | 添加分类-成功 | 添加有效分类名 | 调用addCategory，列表刷新 | 高 |
| CM-005 | 删除分类-确认 | 删除分类并确认 | 调用deleteCategory，该分类密码移到"未分类" | 高 |
| CM-006 | 删除分类-取消 | 删除分类但取消 | 不调用deleteCategory | 高 |
| CM-007 | 重命名分类 | 重命名分类 | 调用renameCategory，列表刷新 | 高 |
| CM-008 | 重命名为已存在 | 重命名为已存在的名称 | 显示错误 | 中 |
| CM-009 | 重命名-回车确认 | 编辑时按回车 | 确认重命名 | 低 |
| CM-010 | 重命名-Esc取消 | 编辑时按Esc | 取消编辑 | 低 |

#### 2.7.4 SettingsModal 测试用例

**文件**: `src/components/SettingsModal.test.tsx`

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| SM-001 | 标签页切换 | 点击不同标签页 | 显示对应的内容 | 高 |
| SM-002 | Ollama-启用切换 | 切换启用开关 | enabled状态变化，相关配置项显示/隐藏 | 高 |
| SM-003 | Ollama-连接测试 | 点击测试按钮 | 调用checkOllama，显示状态 | 高 |
| SM-004 | 安全配置-自动锁定 | 切换自动锁定开关 | 超时设置显示/隐藏 | 中 |
| SM-005 | 安全配置-剪贴板清除 | 切换剪贴板清除开关 | 超时设置显示/隐藏 | 中 |
| SM-006 | 危险操作-启用全部清除 | 切换开关 | 显示警告提示 | 中 |
| SM-007 | 保存配置 | 点击保存 | 调用updateConfig，显示成功提示 | 高 |
| SM-008 | 加载配置 | 打开modal时 | 调用getConfig，填充表单 | 高 |

---

### 2.8 页面测试用例

#### 2.8.1 LoginPage 测试用例

**文件**: `src/pages/LoginPage.test.tsx` (已有基础测试)

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| LP-001 | 渲染-登录表单 | 组件挂载 | 显示登录表单 | 高 |
| LP-002 | 密码显示/隐藏 | 点击眼睛图标 | 切换密码可见性 | 高 |
| LP-003 | 登录-空密码 | 提交空密码 | 显示错误"请输入主密码" | 高 |
| LP-004 | 登录-错误密码 | 输入错误密码 | 显示错误"密码错误" | 高 |
| LP-005 | 登录-成功 | 输入正确密码 | 调用login，成功后切换到main视图 | 高 |
| LP-006 | 忘记密码 | 点击忘记密码 | 切换到忘记密码流程 | 高 |
| LP-007 | 重置密码-警告 | 进入忘记密码流程 | 显示数据清除警告 | 高 |
| LP-008 | 重置密码-步骤1到2 | 点击继续 | 进入步骤2（设置新密码） | 高 |
| LP-009 | 重置密码-验证 | 输入不一致的密码 | 显示错误"两次输入的密码不一致" | 高 |
| LP-010 | 重置密码-长度验证 | 输入短密码(<6位) | 显示错误"密码长度至少为6位" | 高 |
| LP-011 | 重置密码-成功 | 输入有效新密码 | 调用resetPassword，成功后切换到main | 高 |
| LP-012 | 返回登录 | 点击返回登录 | 回到登录界面 | 中 |
| LP-013 | 组件卸载重置 | 组件重新挂载 | 所有状态重置为初始值 | 中 |

#### 2.8.2 SetupPage 测试用例

**文件**: `src/pages/SetupPage.test.tsx`

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| SP-001 | 渲染-设置表单 | 组件挂载 | 显示设置表单和安全提示 | 高 |
| SP-002 | 密码强度-实时显示 | 输入密码 | 实时显示密码强度指示器 | 高 |
| SP-003 | 密码强度-颜色变化 | 输入不同强度密码 | 强度条颜色和文字正确变化 | 中 |
| SP-004 | 验证-短密码 | 输入<8位密码 | 显示错误"主密码至少需要8位" | 高 |
| SP-005 | 验证-密码不一致 | 确认密码与主密码不同 | 显示错误"两次输入的密码不一致" | 高 |
| SP-006 | 提交-成功 | 输入有效密码并提交 | 调用setup，成功后切换到main | 高 |
| SP-007 | 提交-失败 | 模拟setup返回错误 | 显示错误信息 | 高 |
| SP-008 | 密码显示/隐藏 | 点击眼睛图标 | 同时切换两个密码输入框的可见性 | 中 |

#### 2.8.3 MainPage 测试用例

**文件**: `src/pages/MainPage.test.tsx`

| 用例ID | 用例名称 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| MP-001 | 加载密码列表 | 组件挂载 | 调用listPasswords，显示密码卡片 | 高 |
| MP-002 | 加载分类 | 组件挂载 | 加载分类列表，显示在侧边栏 | 高 |
| MP-003 | 搜索功能 | 输入搜索词 | 调用listPasswords带search参数 | 高 |
| MP-004 | 分类筛选 | 点击分类 | 调用listPasswords带category参数 | 高 |
| MP-005 | 显示全部 | 点击"全部" | 显示所有密码 | 高 |
| MP-006 | 打开添加Modal | 点击添加按钮 | 显示AddPasswordModal | 高 |
| MP-007 | 添加成功刷新 | 添加密码成功后 | 刷新密码列表 | 高 |
| MP-008 | 打开编辑Modal | 点击编辑按钮 | 显示EditPasswordModal | 高 |
| MP-009 | 编辑成功刷新 | 编辑成功后 | 刷新密码列表 | 高 |
| MP-010 | 删除成功刷新 | 删除成功后 | 从列表中移除该密码 | 高 |
| MP-011 | 打开分类管理 | 点击管理分类 | 显示CategoryModal | 高 |
| MP-012 | 打开设置 | 点击设置 | 显示SettingsModal | 高 |
| MP-013 | 退出登录 | 点击退出 | 调用logout，切换到login视图 | 高 |
| MP-014 | 全部清除 | 点击全部清除并确认 | 调用clearAllPasswords，列表清空 | 高 |
| MP-015 | 导出密码 | 点击导出 | 显示ExportModal | 中 |
| MP-016 | 智能导入 | 点击AI智能导入 | 显示SmartImportModal | 中 |
| MP-017 | 修改主密码 | 点击修改主密码 | 显示ChangePasswordModal | 中 |
| MP-018 | 空状态显示 | 无密码时 | 显示空状态提示 | 中 |
| MP-019 | 搜索无结果 | 搜索无匹配时 | 显示无结果提示 | 中 |

---

## 3. 测试优先级说明

### 优先级定义

- **高 (High)**: 核心功能，必须测试，影响主要业务流程
- **中 (Medium)**: 重要功能，建议测试，影响用户体验
- **低 (Low)**: 边缘情况，可选测试，代码健壮性

### 按优先级统计

| 模块 | 高优先级 | 中优先级 | 低优先级 | 总计 |
|------|----------|----------|----------|------|
| CryptoService | 23 | 9 | 3 | 35 |
| PasswordService | 17 | 6 | 0 | 23 |
| DatabaseService | 16 | 6 | 0 | 22 |
| OllamaService | 8 | 5 | 0 | 13 |
| Utils | 0 | 0 | 5 | 5 |
| AppStore | 0 | 2 | 1 | 3 |
| UI Components | 28 | 12 | 2 | 42 |
| Pages | 21 | 8 | 1 | 30 |
| **总计** | **113** | **48** | **12** | **173** |

---

## 4. 测试实现建议

### 4.1 测试文件命名规范

```
{原文件名}.test.ts
{原文件名}.test.tsx  // React组件
```

### 4.2 测试结构模板

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';

// 对于服务层测试
import { CryptoService } from '../electron/services/crypto';

describe('CryptoService', () => {
  let service: CryptoService;

  beforeEach(() => {
    service = new CryptoService();
  });

  describe('generateSalt', () => {
    it('should generate a 64-character hex string', () => {
      const salt = service.generateSalt();
      expect(salt).toMatch(/^[a-f0-9]{64}$/);
    });
    // ... 更多测试
  });
});
```

### 4.3 Mock建议

```typescript
// Mock electronAPI
beforeEach(() => {
  (window as any).electronAPI = {
    listPasswords: vi.fn(),
    addPassword: vi.fn(),
    // ... 其他方法
  };
});

// Mock electron-store (用于Node.js环境测试)
vi.mock('electron-store', () => {
  return {
    default: vi.fn().mockImplementation(() => ({
      get: vi.fn(),
      set: vi.fn(),
    })),
  };
});
```

---

## 5. 执行计划建议

### 阶段1: 核心服务层 (Week 1)
- CryptoService (35个用例)
- PasswordService (23个用例)
- DatabaseService (22个用例)

### 阶段2: AI服务和工具 (Week 2)
- OllamaService (13个用例)
- Utils补充 (5个用例)
- AppStore补充 (3个用例)

### 阶段3: UI组件 (Week 3)
- PasswordCard (15个用例)
- AddPasswordModal (15个用例)
- CategoryModal (10个用例)

### 阶段4: 页面和集成 (Week 4)
- LoginPage补充 (8个用例)
- SetupPage (8个用例)
- MainPage (19个用例)

---

*文档生成时间: 2026-02-09*
*基于项目版本: 密码管家 v1.0.0*
